(this["webpackJsonpmonitoring-frontend"]=this["webpackJsonpmonitoring-frontend"]||[]).push([[0],{106:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n.n(o),r=n(22),i=n.n(r),c=(n(93),n(94),n(33)),l=n(59),s=n(14),u=n(32),d=n(25),m=n(38),f={installationStructure:void 0,selectedFloaterCoordinate:null},v={setInstallationStructure:Object(m.createAction)("SET_INSTALLATION_STRUCTURE",(function(e){return{structure:e}}))(),setSelectedCoordinate:Object(m.createAction)("BAR_VIEW/SET_SELECTED_FLOATER_COORDINATE",(function(e){return{coordinate:e}}))(),selectNextFloater:Object(m.createAction)("BAR_VIEW/SELECT_NEXT_FLOATER")(),selectPreviousFloater:Object(m.createAction)("BAR_VIEW/SELECT_PREVIOUS_FLOATER")(),clearSelectedCoordinate:Object(m.createAction)("BAR_VIEW/CLEAR_SELECTED_FLAOTER_COORDINATE")()},b=Object(m.createReducer)(f).handleAction(v.setInstallationStructure,(function(e,t){return Object(d.a)({},e,{installationStructure:t.payload.structure})})).handleAction(v.setSelectedCoordinate,(function(e,t){return Object(d.a)({},e,{selectedFloaterCoordinate:t.payload.coordinate})})).handleAction(v.clearSelectedCoordinate,(function(e){return Object(d.a)({},e,{selectedFloaterCoordinate:null})})).handleAction(v.selectNextFloater,(function(e){return Object(d.a)({},e,{selectedFloaterCoordinate:E(e.selectedFloaterCoordinate)})})).handleAction(v.selectPreviousFloater,(function(e){return Object(d.a)({},e,{selectedFloaterCoordinate:g(e.selectedFloaterCoordinate)})}));function E(e){return null===e?null:3===e.x&&4===e.y?e:e.x<3?{x:e.x+1,y:e.y}:{x:0,y:e.y+1}}function g(e){return null===e?null:0===e.x&&0===e.y?e:e.x>0?{x:e.x-1,y:e.y}:{x:3,y:e.y-1}}var p=Object(u.combineReducers)({barView:b}),h=n(69),O=n(70),j=Object(u.createStore)(p,Object(h.composeWithDevTools)(Object(u.applyMiddleware)(O.a))),w=n(125),x=n(71),y=(n(98),n(82)),S=n(126),C=Object(y.a)({palette:{primary:{main:"#1070E4"},secondary:{main:"#FFEA00"}}});console.log("\ud83c\udfde","ALTERNATIVE THEME",C);var A=function(e){return o.createElement(s.a,{store:j},o.createElement(l.a,{basename:"/sunlitsea-monitoring-demo"},o.createElement(w.a,{utils:x.a},o.createElement(S.a,{theme:C},e.children))))},T=n(8),P=n(130),F=n(83),M=n(17),R={_mixers:[],floaterMesh:void 0,gridDimensions:{x:0,y:0}},k=n(137),L=n(84),N=n(1),V=n(75),_=function(){var e=Object(o.useState)(),t=Object(T.a)(e,2),n=t[0],a=t[1],r=Object(o.useContext)(te);return Object(o.useEffect)((function(){Promise.all([I(),H()]).then((function(e){var t=Object(T.a)(e,2),n=t[0],o=t[1],a=n.material;if("Body"!==a[0].name||"Solcelle"!==a[1].name)throw new Error("Unexpected loading result wrt materials");return o.wrapS=N.RepeatWrapping,o.wrapT=N.RepeatWrapping,a[0].color.setHex(2829615),a[1].color.setHex(16777215),a[1].emissive.setHex(0),a[1].needsUpdate=!0,a[1].map=o,n.geometry.scale(3/225,3/225,3/225),console.log("\u2139\ufe0f","floaterMesh",n),n})).then((function(e){r.floaterMesh=e,a(e)}))}),[]),n};function I(){var e=new L.a;return new Promise((function(t,n){e.load("/res/panel.fbx",(function(e){e.traverse((function(e){"Mesh"===e.type&&("Panel"===e.name?t(e):n("Unexpected loading result"))}))}))}))}function H(){var e=new V.a;return new Promise((function(t){e.load("/res/panel-texture.tga",(function(e){t(e)}))}))}var W=3,D=1,B=function(){var e,t=Object(M.e)();!function(){var e=Object(M.e)();Object(o.useEffect)((function(){}),[e.gl])}(),e=t.scene,Object(o.useEffect)((function(){e.background=(new N.Color).setHSL(.6,0,1),e.fog=new N.Fog(e.background,1,5e3);var t=new N.HemisphereLight(16777215,16777215,.6);t.color.setHSL(.6,1,.6),t.groundColor.setHSL(.095,1,.75),t.position.set(0,300,0),e.add(t);var n=new N.DirectionalLight(16777215,1);n.color.setHSL(.1,1,.95),n.position.set(-1,1.75,1),n.position.multiplyScalar(200),e.add(n),n.castShadow=!0,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048,n.shadow.camera.left=-50,n.shadow.camera.right=50,n.shadow.camera.top=50,n.shadow.camera.bottom=-50,n.shadow.camera.far=3500,n.shadow.bias=-1e-4}),[e])},z=n(64),G=n(127),U=n(128),Y=n(129),J={mass:1,tension:170,friction:26},X=(G.a(U.a,(function(e){var t=Math.pow(Math.PI,2)*J.mass/Math.pow(3*e,2),n=Object(d.a)({},J,{tension:t,friction:20/17*t});return console.log("\ud83c\udfde","config is",n),n})),G.a(U.a,(function(e){var t={duration:1e3*e,easing:Y.a};return console.log("\ud83c\udfde","config is",t),t}))),$=function(e){var t=Object(o.useContext)(te),n=Object(o.useMemo)((function(){if(void 0===t.floaterMesh)throw new Error("Floater model is not ready");var e=t.floaterMesh.clone(),n=new N.Group;return n.add(e),n}),[t.floaterMesh]),a=Object(o.useState)({pos:e.position,from:{pos:e.position},config:X(e.motionPeriod)}),r=Object(T.a)(a,2),i=r[0],c=r[1],l=Object(z.b)(Object(d.a)({},i)),s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=Object(o.useRef)(t);return Object(o.useEffect)((function(){n.current=e}),[e]),n.current}(e);Object(o.useEffect)((function(){c({pos:e.position,from:{pos:void 0!==s?s.position:e.position},config:X(e.motionPeriod)})}),[e.position,e.motionPeriod]);var u=Object(o.useRef)();return Object(o.useEffect)((function(){if(e.selected){var t=new N.BoxGeometry(3.2,.3,3.2),o=new N.MeshPhongMaterial({color:1077476,opacity:.5,transparent:!0}),a=new N.Mesh(t,o);u.current=a,n.add(a)}else n.remove(u.current)}),[e.selected,n]),Object(o.useMemo)((function(){return n?o.createElement(o.Fragment,null,o.createElement(z.a.primitive,{onClick:e.onClick,object:n,position:l.pos})):null}),[l.pos,n,e.onClick])},q=n(135),K=n(53),Q=n(136),Z=function(e){var t=function(e){var t=Object(s.d)((function(e){return e.barView.selectedFloaterCoordinate}));return(null===t||void 0===t?void 0:t.x)===(null===e||void 0===e?void 0:e.x)&&(null===t||void 0===t?void 0:t.y)===(null===e||void 0===e?void 0:e.y)}(e.gridPosition),n=Object(o.useMemo)((function(){return[W/2+e.gridPosition.y*(W+D),0,W/2+e.gridPosition.x*(W+D)]}),[e.gridPosition]),a=Object(o.useState)(0),r=Object(T.a)(a,2),i=r[0],c=r[1];Object(o.useEffect)((function(){q.a(K.a((function(){return[4,0,3,0]})),Q.a)(k.a(0,100)).forEach((function(e,t){setTimeout((function(){c(e)}),3e3*t)}))}),[]);var l=Object(s.c)(),u=Object(o.useCallback)((function(){return l(v.setSelectedCoordinate(e.gridPosition))}),[l,e.gridPosition]);return o.createElement(o.Fragment,null,o.createElement($,{onClick:u,position:Object(o.useMemo)((function(){return[n[0],i,n[2]]}),[i,n]),motionPeriod:3,selected:t}))},ee=function(e){var t=Object(o.useContext)(te),n=Object(o.useMemo)((function(){return k.a(0,t.installationStructure.x).map((function(t){return{key:"".concat(t,"_").concat(e.index),gridPosition:{x:t,y:e.index}}}))}),[t.installationStructure,e.index]);return o.createElement(o.Fragment,null,n.map((function(e){return o.createElement(Z,e)})))},te=o.createContext(R),ne=function(e){console.log("BarViewScene render");var t=R,n=_();return B(),function(e){var t=Object(M.e)(),n=Object(o.useMemo)((function(){return[W+(e.y-1)*(W+D),0,W+(e.x-1)*(W+D)]}),[e.y,e.x]);Object(o.useEffect)((function(){var e=t.camera;e.position.x=10,e.position.y=15,e.position.z=24,e.lookAt(new N.Vector3(n[0]/2,0,n[2]/3+4)),console.log("\ud83d\udcf7","position",e.position,"where to point",n)}),[n,t.camera,e])}(e.barView.installationStructure),Object(o.useEffect)((function(){t.installationStructure=e.barView.installationStructure}),[e.barView,t]),o.createElement(te.Provider,{value:t},n&&e.barView.installationStructure&&k.a(0,e.barView.installationStructure.y).map((function(e){return o.createElement(ee,{index:e,key:e})})))};var oe=function(){return function(e){return Promise.resolve({x:4,y:5}).then((function(t){e(v.setInstallationStructure(t))}))}},ae=Object(P.a)((function(e){return{mainContainer:{position:"absolute",top:"0",zIndex:1,left:"0",width:"100vw",height:"100vh"},canvas:{}}})),re=function(){var e=ae(),t=function(){var e=Object(o.useState)({x:0,y:0}),t=Object(T.a)(e,2),n=t[0],a=t[1];return[n,Object(o.useCallback)((function(e,t){a({x:e,y:t})}),[a])]}(),n=Object(T.a)(t,2),a=n[0],r=n[1],i=Object(s.d)((function(e){return e.barView})),c=Object(s.c)();return Object(o.useEffect)((function(){c(oe())}),[]),o.createElement("div",{className:e.mainContainer},o.createElement(F.a,{handleHeight:!0,handleWidth:!0,onResize:r}),o.createElement(s.b.Consumer,null,(function(t){var n=t.store;return o.createElement(M.a,{className:e.canvas,resize:{scroll:!1}},o.createElement(s.a,{store:n},i.installationStructure&&o.createElement(ne,{size:a,barView:i})))})))},ie=function(e){var t=ce();return o.createElement("div",{className:t.absoluteRoot},o.createElement("div",{className:t.relativeRoot},e.children))},ce=Object(P.a)((function(e){return{absoluteRoot:{position:"absolute",top:0,left:0,height:"100vh",width:"100vw"},relativeRoot:{position:"relative",height:"100vh",width:"100vw",zIndex:2,pointerEvents:"none"}}})),le=n(134),se=n(132),ue=n(131),de=n(133),me=n(26),fe=n.n(me);function ve(e){return"HF".concat((t=4*e.y+e.x,(t+="").length>=(n=2)?t:new Array(n-t.length+1).join("0")+t));var t,n}var be=function(){var e=Object(s.c)(),t=Object(o.useCallback)((function(){return e(v.selectNextFloater())}),[e]),n=Object(o.useCallback)((function(){return e(v.selectPreviousFloater())}),[e]),a=Object(s.d)((function(e){return e.barView.selectedFloaterCoordinate})),r=Ee(),i=Object(o.useMemo)((function(){return null===a?null:ge[(4*(e=a).y+e.x)%5];var e}),[a]);return o.createElement("div",{className:r.root},o.createElement("div",{className:r.titleArea},null!==a&&o.createElement(le.a,{classes:{root:r.chevron},onClick:n},o.createElement(ue.a,null)),o.createElement(se.a,{variant:"h4",classes:{root:r.heading}},null!==a?"Floater ".concat(ve(a)):"Select a floater..."),null!==a&&o.createElement(le.a,{classes:{root:r.chevron},onClick:t},o.createElement(de.a,null))),null!==a&&o.createElement("div",{className:r.grid},o.createElement(se.a,{variant:"subtitle1"},"Position"),o.createElement(se.a,{variant:"body1"},"Column ".concat(null===a||void 0===a?void 0:a.y," Row ").concat(null===a||void 0===a?void 0:a.x)),o.createElement(se.a,{variant:"subtitle1"},"Status"),o.createElement(se.a,{variant:"body1",className:"End of life approaches"===i.status?r.error:""},i.status),o.createElement(se.a,{variant:"subtitle1"},"Avg production [W]"),o.createElement(se.a,{variant:"body1"},i.averageProduction),o.createElement(se.a,{variant:"subtitle1"},"Avg tension [Nm]"),o.createElement(se.a,{variant:"body1"},i.averageTension),o.createElement(se.a,{variant:"subtitle1"},"Avg sun obstruction [%]"),o.createElement(se.a,{variant:"body1"},i.averageSunObstruction),o.createElement(se.a,{variant:"subtitle1"},"Messages"),o.createElement("div",null,i.messages.map((function(e){return o.createElement(se.a,{variant:"body1"},"".concat(fe()(e.time).format("YYYY-MM-DD HH:MM")," ").concat(e.message))})))))};var Ee=Object(P.a)((function(e){return{root:{position:"absolute",bottom:0,left:0,width:"600px",height:"275px",padding:"16px",pointerEvents:"all",background:e.palette.primary.main,color:e.palette.primary.contrastText},heading:{textAlign:"center"},titleArea:{display:"flex",justifyContent:"space-around"},chevron:{color:"#fff"},grid:{display:"grid",gridTemplateColumns:"1fr 2fr",marginTop:"20px",marginLeft:"50px"},error:{textDecoration:"overline underline"}}})),ge=[{status:"Good",averageProduction:200,averageSunObstruction:15,averageTension:9.6,messages:[{time:fe()("2020-06-22 18:12").valueOf(),message:"45% obstruction for over 2 hours"},{time:fe()("2020-06-22 19:02").valueOf(),message:"Obstruction is at 0%"}]},{status:"Good",averageProduction:196,averageSunObstruction:8,averageTension:10.4,messages:[]},{status:"Good",averageProduction:186,averageSunObstruction:6,averageTension:11.2,messages:[{time:fe()("2020-06-23 19:02").valueOf(),message:"Tension is high, consider maintenance"}]},{status:"Good",averageProduction:186,averageSunObstruction:7,averageTension:11.2,messages:[]},{status:"End of life approaches",averageProduction:166,averageSunObstruction:14,averageTension:12.2,messages:[]}],pe=function(){return o.createElement(ie,null,o.createElement(be,null))};var he=function(){return a.a.createElement(A,null,a.a.createElement(c.d,null,a.a.createElement(c.a,{exact:!0,from:"/",to:"/dash"}),a.a.createElement(c.b,{path:"/dash"},a.a.createElement(re,null),a.a.createElement(pe,null))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(he,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},88:function(e,t,n){e.exports=n(106)},93:function(e,t,n){},94:function(e,t,n){}},[[88,1,2]]]);
//# sourceMappingURL=main.bd23d145.chunk.js.map